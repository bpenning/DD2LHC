<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>DM Limiter</title>

	<!-- custom -->
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}" />
	<link href="https://fonts.googleapis.com/css?family=Orbitron" rel="stylesheet">

	<!-- bokeh -->
	<link rel="stylesheet" href="http://cdn.pydata.org/bokeh/release/bokeh-0.12.5.min.css" type="text/css" />
	<script type="text/javascript" src="http://cdn.pydata.org/bokeh/release/bokeh-0.12.5.min.js"></script>

	<!-- boostrap -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

	<head>
	    <script type="text/javascript">
	        window.onload = function() {
	          var dataBtn = document.getElementById("showData");
						var pdfBtn = document.getElementById("downloadPDF");
	          dataBtn.onclick = function() {
							var data = document.getElementById("dataDiv");
							data.style.display = "block";
							return false;
	          }
						pdfBtn.onclick = function() {
							alert('PDF Functionality coming next.');
							return false;
						}
	        }
	    </script>
	</head>
	<!-- plot -->
	{% if plot_script %}
		{{ plot_script | safe}}
	{% endif %}
</head>

<body class="bg-light text-dark">
	<script type="text/javascript">
	function displayMetadata(form){
		//Parse all metadata from flask into data structure
		var metadata = [];
		{% for data in allmetadata  %}
		metadata.push({{data|tojson}});
		{% endfor %}
		//Generate the new metadata to display, depending if item is selected
		var displayText = "";
		for (i=0; i<form.options.length; i=i+1) {
    if (form.options[i].selected ) {
				displayText += getMetadataDisplay(metadata[i]);
    	}
		}
		//Push the text to the html element
		var textElement = document.getElementById('datasetInfo');
		textElement.innerHTML = displayText;
	}
	function getMetadataDisplay(metadata){
		var displayText = "";
		displayText += "<div class='row'>";
		displayText += "<div class='col col-2'>";
		displayText += "Filename:";
		displayText += "</div>";
		displayText += "<div class='col'>";
		displayText += metadata['fileName'];
		displayText += "</div>";
		displayText += "</div>";

		displayText += "<div class='row'>";
		displayText += "<div class='col col-2'>";
		displayText += "Label:";
		displayText += "</div>";
		displayText += "<div class='col'>";
		displayText += metadata['dataLabel'];
		displayText += "</div>";
		displayText += "</div>";

		displayText += "<div class='row'>";
		displayText += "<div class='col col-2'>";
		displayText += "Comment:";
		displayText += "</div>";
		displayText += "<div class='col'>";
		displayText += metadata['dataComment'];
		displayText += "</div>";
		displayText += "</div>";
		displayText = displayText + '<hr>';
		return displayText;
	}
	function updateConditionalSelect(conditionalSelect){
		var selectedInput = "";
		var inputs = document.getElementsByName("conditional_input");
		for (var i = 0, length = inputs.length; i < length; i++) {
 			if (inputs[i].checked) {
  			// do whatever you want with the checked radio
  			selectedInput = inputs[i].value;
				// only one radio can be logically checked, don't check the rest
  			break;
 			}
		}

		//Parse all metadata from flask into data structure
		var metadata = [];
		{% for data in allmetadata  %}
		metadata.push({{data|tojson}});
		{% endfor %}

		var form = document.getElementById("datasets");
		for (i=0; i<form.options.length; i=i+1) {
			var meta = metadata[i];
			//If this meta matches the selected input, then we select in form
			form.options[i].selected = false; //Deselect previous selction
			if(meta['spinDependency'] === selectedInput){
				form.options[i].selected = true;
			}
		}
		//Now make sure the metadata is correct
		displayMetadata(form);
	}
	</script>

	<!--
	<nav class="navbar navbar-expand-md" style="background-color:white;">
		<div class="container">
			<div class="row">
				<div class="col-lg justify-content-start">
					<img id="headerLogo" src="{{ url_for('static', filename='img/brandeis.png') }}">
					<br>
					<a class="btn btn-outline-primary" href="http://www.brandeis.edu/departments/physics/">Brandeis University - Center for the Dark Universe</a>
				</div>
				<div class="col justify-content-end" style="text-align:right">
					<img id="dmLogo" src="{{ url_for('static', filename='img/darkmatter.jpg') }}"/>
				</div>
			</div>
		</div>
	</nav>
-->
	<nav class="navbar navbar-expand-md bg-primary navbar-dark" style="text-align:right">
		<div class="container">
			<div class="row">
			<div class="col justify-content-start" style="text-align: left;">
				<a class="btn btn-outline-primary text-white" href="http://www.brandeis.edu/departments/physics/">Brandeis University - Center for the Dark Universe</a>
			</div>
				<div class="col justify-content-end" >
					<a href="#" class="btn btn-outline-primary text-white">Theory</a>
					<a href="#" class="btn btn-outline-primary text-white">About</a>
					<a href="#" class="btn btn-outline-primary text-white">Login</a>
				</div>
			</div>
		</div>
	</nav>

<div class="container">

<div class="container">
		<div class="row">
			<div class="col-md-12" >
				<div id="dmTitle">
					DM Limiter
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12" >
				<p class="subTitle">Dark matter limit comparisons using simplified models</p>
			</div>
		</div>
	</div>

	 <div class="row justify-content-start" style="margin-top:5%;">
  	<div class="col justify-content-start">
  		<h3>How this app works</h3>
  		<ul>
  			<li>Select two or more limit samples</li>
  			<li>Create comparison plot</li>
  			<li>Download PDF for publications.</li>
  			<li>Use XXX to cite us</li>
				<li>TOOL VERY PRELIMINARY YET</li>
  		</ul>
  	</div>
		<div class="col justify-content-end">
			<h3>Upload new dataset</h3>
			<form method="POST" action="/upload" enctype="multipart/form-data">
				{{ dataset_upload.hidden_tag() }}
				{{ dataset_upload.data_file(class="btn btn-default") }}
			<div style='text-align:right;'>
				{{ dataset_upload.upload_button(class="btn btn-outline-primary") }}
			</div>
			</form>
		</div>
	</div>

<div class="headerTitle">
	Dataset Selection
</div>

<div class="datainput">
	<form method="POST" action="/index" name="dataset_selection">
  	<div class="row justify-content-start">
			<div class="col">
				<h3>Select datasets to plot:</h3>
					{{ dataset_selection.hidden_tag() }}
					{{ dataset_selection.datasets(class="selectpicker",**{"onchange":"displayMetadata(this)"}) }}
			</div>

		<div class="col justify-content-end">
			<h3>Conditionally Select Datasets:</h3>
				{{dataset_selection.conditional_input(**{"onchange":"updateConditionalSelect(this)"}) }}
		</div>

	</div>
<div class="row justify-content-start" style="margin-top:10px;">
	<div class="col">
		<h3>Standard Model coupling constant:</h3>
				gSM = {{ dataset_selection.gSM_input}}<br>
	</div>
	<div class="col" style='text-align:right;'>
		<div id="parent">
			<div id="child">

				{{ dataset_selection.select(class="btn btn-outline-primary") }}
			</div></div>
	</div>
</div>
</form>
	<hr>

	<div class="row justify-content-start">
		<div class="col justify-content-start">
			<h3>Dataset Info</h3>
				<div id='datasetInfo'>
				</div>
		</div>
  </div>

</div>

<!-- -->

<div class="headerTitle">
	Comparison Plot
</div>

<div class="datainput">
			<div class="row">
				<div class="col"></div>
				<div class="col justify-content-center">
					{% if plot_div is defined %}
						{{ plot_div | safe }}
					{% endif %}
				</div>
				<div class="col"></div>
			</div>
			<hr>
	<div class="row justify-content-start" style="margin-top:5%;">
		<div class="col">
			<h3>Selected Datasets:</h3>
			{% for data in metadata  %}
			<div class='row'>
				<div class='col col-2'>Filename:</div>
				<div class='col'>{{data['fileName']}}</div>
			</div>
			<div class='row'>
				<div class='col col-2'>Label:</div>
				<div class='col'>{{data['dataLabel']}}</div>
			</div>
			<div class='row'>
				<div class='col col-2'>Comment:</div>
				<div class='col'>{{data['dataComment']}}</div>
			</div>
			<hr>
			{% endfor %}
		</div>
		<div class="col justify-content-end">
			<h3>Selected Standard Model coupling constant:</h3>
			<p>	gSM= {{gSM_gSM}}<br>
			</p>
		</div>
	</div>
</div>

<hr>

<div id="plotButtons">
	<a id="showData" href="#" class="btn btn-outline-primary">Show Data</a>
	<a id="downloadPDF" href="#" class="btn btn-outline-primary">Download PDF</a>
</div>

		<div class="row justify-content-center" style="margin-top:5%;">
  		<div class="col" id="dataDiv">
  			{% if data_table is defined %}
  				<h3>The data</h3>
  				{{ data_table | safe }}
  			{% endif %}
  		</div>
		</div>

</div>


</div> <!-- Container -->
</body>
</html>
